{% extends "layout/base.html" %}

{% block title %}Home{% endblock %}

{% load static %}

{% block content %}
<div class="my-2 analisis">
    <h2 class="titulo_principal centrar">Analisis Mantenimiento</h2>
    <div id="goalChart" style="width: 100%; height: 350px; margin: auto;"></div>
    <div id="userChart" style="width: 100%; height: 350px; margin: auto; margin-top: 20px;"></div>

    <div class="resumen" style="margin-top: 40px;">
        <h3>Resumen</h3>
        <table class="table-primary">
            <thread>
                <tr>
                    <th scope="col">Fecha</th>
                    <th scope="col">Equipos Reparados</th>
                    <th scope="col">Tecnico Responsable</th>
                </tr>
            </thread>
            <tbody>
                <tr>
                    <th scope="row">04/04/2023</th>
                    <td>80</td>
                    <td>Yamcha Cota</td>
                </tr>
                <tr>
                    <th scope="row">05/04/2023</th>
                    <td>90</td>
                    <td>Francisco Rodriguez</td>
                </tr>
                <tr>
                    <th scope="row">06/04/2023</th>
                    <td>10</td>
                    <td>Efrain Ramirez</td>
                </tr>
            </tbody>
    </div>
</div>

<!-- Cargar ApexCharts desde un CDN -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
    // Definir la meta
    var meta = 80;

    // Gráfico de barras con línea de meta
    var goalOptions = {
        series: [{
            name: 'Equipos Reparados',
            data: [80, 90, 70, 85, 60, 80, 10, 90, 70, 85] // Datos para 10 periodos
        }],
        chart: {
            type: 'bar',
            height: 350
        },
        plotOptions: {
            bar: {
                horizontal: false,
                columnWidth: '60%',
                endingShape: 'rounded'
            },
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            show: false,
            width: 2,
            colors: ['transparent']
        },
        xaxis: {
            categories: ['WK 1', 'WK 2', 'WK 3', 'WK 4', 'WK 5', 'WK 6', 'WK 7', 'WK 8', 'WK 9', 'WK 10'], // Cambia según tus periodos
        },
        yaxis: {
            title: {
                text: 'Feeders Registrados'
            },
            labels: {
                formatter: function (value) {
                    return value; // Formatea según sea necesario
                }
            }
        },
        fill: {
            opacity: 0.8
        },
        tooltip: {
            y: {
                formatter: function (value) {
                    return value + " equipos";
                }
            }
        },
        title: {
            text: 'Meta feeder por semana',
            align: 'center'
        },
        annotations: {
            yaxis: [{
                y: meta,
                borderColor: '#FF0000',
                label: {
                    borderColor: '#FF0000',
                    style: {
                        color: '#fff',
                        background: '#FF0000'
                    },
                    text: 'Meta: ' + meta + ' equipos'
                }
            }]
        }
    };

    var goalChart = new ApexCharts(document.querySelector("#goalChart"), goalOptions);
    goalChart.render();

    // Gráfico de barras para 3 usuarios
    var userOptions = {
        series: [{
            name: 'Equipos Reparados',
            data: [50, 30, 70]
        }],
        chart: {
            type: 'bar',
            height: 350
        },
        plotOptions: {
            bar: {
                horizontal: false,
                columnWidth: '55%',
                endingShape: 'rounded'
            },
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            show: true,
            width: 2,
            colors: ['transparent']
        },
        xaxis: {
            categories: ['Usuario 1', 'Usuario 2', 'Usuario 3'],
        },
        yaxis: {
            title: {
                text: 'Equipos Reparados'
            }
        },
        fill: {
            opacity: 1,
            colors: ['#9966FF', '#FF9F40', '#36A2EB']
        },
        tooltip: {
            y: {
                formatter: function (val) {
                    return val + " equipos"
                }
            }
        }
    };

    var userChart = new ApexCharts(document.querySelector("#userChart"), userOptions);
    userChart.render();
</script>

{% endblock %}